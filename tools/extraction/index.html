<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Table / Invoice Data Extractor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #22406a;
    }
    .app-box {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(65,102,146,0.10);
      margin: 36px 0 30px 0;
      padding: 33px 24px 22px 24px;
      max-width: 700px;
      width: 100%;
    }
    h1 {
      text-align:center;
      margin-bottom:14px;
      font-size:2.05em;
      letter-spacing:1px;
      font-weight:900;
      color: #3161af;
    }
    .desc {
      text-align: center;
      font-size:1.03em;
      color: #426baf;
      margin-bottom:4px;
      font-weight:600;
    }
    .how {
      text-align:center;
      font-size:0.97em;
      color:#587195;
      margin-bottom:19px;
      font-style:italic;
    }
    #drop-area {
      width: 97%;
      max-width: 420px;
      min-height: 80px;
      border: 2px dashed #99aed7;
      border-radius: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #5670a0;
      font-size: 1.08rem;
      margin-bottom: 19px;
      background: #fafffd;
      cursor: pointer;
      transition: border-color 0.3s, color 0.25s;
      user-select: none;
    }
    #drop-area.highlight {
      border-color: #3161af;
      color: #1c3251;
      background: #f4f7fd;
    }
    input[type=file] { display: none; }
    textarea {
      width: 97%;
      max-width: 650px;
      height: 100px;
      font-family: inherit;
      font-size: 1em;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1.2px solid #b3caea;
      box-sizing: border-box;
      padding: 9px 8px;
      background: #fafdff;
      color: #29527c;
      outline-color: #3161af;
    }
    .btn-row { margin: 12px 0 15px 0; text-align:center;}
    button {
      padding: 9px 18px;
      font-size: 1.03em;
      border-radius: 7px;
      border: none;
      background-color: #3161af;
      color: #fff;
      margin: 5px 10px 7px 0;
      font-weight: 600;
      letter-spacing:0.02em;
      cursor: pointer;
      transition: background 0.22s;
      box-shadow: 0 1px 7px #e3eaf7;
      outline: none;
    }
    button:disabled {
      background: #a5b7d8;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #244377;
    }
    #table-container {
      overflow-x: auto;
      width: 99%;
      max-width: 650px;
      margin-bottom: 13px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 15px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(54,86,122,0.07);
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #dee7f1;
      text-align: left;
      vertical-align: middle;
      min-width: 66px;
    }
    th {
      background: #3161af;
      color: #fff;
      user-select: none;
      font-weight:700;
    }
    td[contenteditable="true"]:focus {
      outline: 2px solid #3161af;
      background: #f0f8fc;
    }
    .footer {
      margin-top: 27px;
      text-align: center;
      color: #62749a;
      font-size: 14px;
      letter-spacing:.01em;
    }
    .footer a { color: #3161af; text-decoration: underline;}
    @media (max-width: 600px) {
      .app-box { padding: 12px 3vw 16px 3vw;}
    }
  </style>
</head>
<body>
  <div class="app-box">
    <h1>Table / Invoice Data Extractor</h1>
    <div class="desc">
      Instantly extract tables, lists, or invoice line-items from images or pasted textâ€”no manual typing, no hassle.
    </div>
    <div class="how">
      Upload or paste your data, review and edit the extracted table in-browser, then copy or export as CSV.<br/>
      <b>All processing is private and local to your browser.</b>
    </div>
    <div id="drop-area" tabindex="0" aria-label="File drop area. Click to upload or drag a file">
      Drag & drop an image here, or <label for="fileElem" style="color: #3161af; cursor:pointer;">browse</label>
      <input type="file" id="fileElem" accept="image/*" />
    </div>
    <textarea id="textInput" placeholder="Or paste your raw table or text here..."></textarea>
    <div class="btn-row">
      <button id="extractTextBtn" disabled>Extract Table</button>
      <button id="clearBtn">Clear Table</button>
    </div>
    <div id="table-container" aria-live="polite"></div>
    <div class="btn-row">
      <button id="copyBtn" disabled>Copy Table</button>
      <button id="exportCsvBtn" disabled>Export as CSV</button>
    </div>
    <div class="footer">
      For more automations visit and follow: <a href="https://effortlessautomation.wordpress.com/" target="_blank">https://effortlessautomation.wordpress.com/</a><br>
      Contact: <a href="mailto:decomplicate001@gmail.com">decomplicate001@gmail.com</a>
    </div>
  </div>
  <!-- Tesseract.js for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <script>
    const dropArea = document.getElementById('drop-area');
    const fileElem = document.getElementById('fileElem');
    const textInput = document.getElementById('textInput');
    const extractTextBtn = document.getElementById('extractTextBtn');
    const clearBtn = document.getElementById('clearBtn');
    const tableContainer = document.getElementById('table-container');
    const copyBtn = document.getElementById('copyBtn');
    const exportCsvBtn = document.getElementById('exportCsvBtn');
    let lastTableData = null; // stores 2d-array

    dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.classList.add('highlight'); });
    dropArea.addEventListener('dragleave', () => dropArea.classList.remove('highlight'));
    dropArea.addEventListener('drop', (e) => {
      e.preventDefault(); dropArea.classList.remove('highlight');
      handleFiles(e.dataTransfer.files);
    });
    dropArea.addEventListener('click', () => fileElem.click());
    fileElem.addEventListener('change', () => handleFiles(fileElem.files));

    extractTextBtn.addEventListener('click', () => {
      if (!textInput.value.trim()) return;
      const table = parseTextTable(textInput.value);
      renderTable(table);
    });

    clearBtn.addEventListener('click', () => {
      tableContainer.innerHTML = '';
      lastTableData = null;
      copyBtn.disabled = true;
      exportCsvBtn.disabled = true;
      textInput.value = '';
      extractTextBtn.disabled = true;
    });

    copyBtn.addEventListener('click', () => {
      if (!lastTableData) return;
      navigator.clipboard.writeText(arrayToCSV(lastTableData)).then(() => alert('Table copied!'));
    });
    exportCsvBtn.addEventListener('click', () => {
      if (!lastTableData) return;
      const csv = arrayToCSV(lastTableData);
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'extracted_table.csv';
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    textInput.addEventListener('input', () => extractTextBtn.disabled = textInput.value.trim() === '');

    async function handleFiles(files) {
      if (!files.length) return;
      clearBtn.click();
      for (const file of files) {
        if (!file.type.startsWith('image/')) { alert('Only images supported for OCR extraction.'); continue; }
        tableContainer.innerHTML = `<p style="color:#3161af;">Performing OCR on image: <b>${file.name}</b> ...</p>`;
        const img = await createImageBitmap(file);
        const canvas = document.createElement('canvas');
        canvas.width = img.width; canvas.height = img.height;
        canvas.getContext('2d').drawImage(img,0,0);
        try {
          const { data: { text } } = await Tesseract.recognize(canvas, 'eng', {
            logger: m => { if(m.status === 'recognizing text') tableContainer.innerHTML = `<p>Extracting text (${Math.round(m.progress*100)}%)...</p>`; }
          });
          tableContainer.innerHTML = '';
          const table = parseTextTable(text);
          renderTable(table);
          textInput.value = text; extractTextBtn.disabled = false;
        } catch (err) {
          tableContainer.innerHTML = `<p style="color:red;">OCR failed: ${err.message}</p>`;
        }
      }
    }

    // Simple heuristic: split lines, detect delim
    function parseTextTable(text) {
      let lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
      const delimiters = ['\t','|',';',',','  '];
      let delim = delimiters[delimiters.map(d=>lines.reduce((a,l)=>a+(l.split(d).length-1),0)).indexOf(Math.max(...delimiters.map(d=>lines.reduce((a,l)=>a+(l.split(d).length-1),0))))];
      if (!delim) delim = /\s{2,}|\s(?=\d)/; // fallback: two+ spaces, or space before digit
      let table = lines.map(l => typeof delim==='string'?l.split(delim).map(x=>x.trim()):l.split(delim));
      let maxCols = Math.max(...table.map(r => r.length));
      table = table.map(r => r.length<maxCols ? r.concat(Array(maxCols-r.length).fill('')) : r);
      return table;
    }

    function renderTable(data) {
      lastTableData = data;
      if (!data || data.length === 0) { tableContainer.innerHTML = '<p>No table detected.</p>'; copyBtn.disabled = exportCsvBtn.disabled = true; return; }
      const table = document.createElement('table'), thead = document.createElement('thead'), tbody = document.createElement('tbody');
      table.appendChild(thead); table.appendChild(tbody);
      const headerRow = document.createElement('tr');
      data[0].forEach(h => { let th = document.createElement('th'); th.textContent=h||''; headerRow.appendChild(th); });
      thead.appendChild(headerRow);
      data.slice(1).forEach((row,ri)=> {
        let tr = document.createElement('tr');
        row.forEach((cell,ci)=> {
          let td = document.createElement('td');
          td.contentEditable="true"; td.textContent=cell||'';
          td.addEventListener('input',()=>{lastTableData[ri+1][ci]=td.textContent;});
          tr.appendChild(td);
        }); tbody.appendChild(tr);
      });
      tableContainer.innerHTML = ''; tableContainer.appendChild(table);
      copyBtn.disabled = exportCsvBtn.disabled = false;
    }
    function arrayToCSV(data){return data.map(row=>row.map(cell=>{cell=(cell||'').toString().replace(/"/g,'""');return cell.search(/("|,|\n)/g)>=0?`"${cell}"`:cell;}).join(',')).join('\n');}
    window.onload=()=>{extractTextBtn.disabled=true;}
  </script>
</body>
</html>
