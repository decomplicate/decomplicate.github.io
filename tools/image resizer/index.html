<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bulk Image Resizer (Safe Mode)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 100%;
    }
    h2 {
      margin-top: 0;
      text-align: center;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      box-sizing: border-box;
    }
    .tabs {
      display: flex;
      margin-bottom: 15px;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 10px;
      background: #eee;
      cursor: pointer;
      transition: background 0.3s;
    }
    .tab.active {
      background: #fff;
      border: 1px solid #ccc;
      border-bottom: none;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .aspect-lock {
      display: flex;
      align-items: center;
    }
    .aspect-lock input {
      margin-right: 8px;
    }
    #status {
      font-size: 0.9em;
      margin-top: 10px;
      color: green;
      text-align: center;
    }
    .info-text {
      font-size: 0.85em;
      color: #555;
      margin-top: 20px;
      text-align: center;
      line-height: 1.5em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Image Resizer</h2>

    <input type="file" id="images" multiple accept="image/*" />

    <div class="tabs">
      <div class="tab active" data-tab="sizeTab">By Size</div>
      <div class="tab" data-tab="percentTab">By Percentage</div>
    </div>

    <div id="sizeTab" class="tab-content active">
      <label>Width (px)</label>
      <input type="number" id="widthInput" placeholder="Enter width" />
      <label>Height (px)</label>
      <input type="number" id="heightInput" placeholder="Enter height" />
      <div class="aspect-lock">
        <input type="checkbox" id="lockAspect" checked />
        <label for="lockAspect">Lock Aspect Ratio</label>
      </div>
    </div>

    <div id="percentTab" class="tab-content">
      <label>Resize to (%)</label>
      <input type="number" id="percentInput" placeholder="e.g. 50 for 50%" />
    </div>

    <button onclick="resizeAndDownload()">Resize & Download</button>
    <p id="status"></p>

    <div class="info-text">
      <h3>Contact: decomplicate001@gmail.com</h3>
 <h4>For more automations visit and follow: <a href="https://effortlessautomation.wordpress.com/" target="_blank" rel="noopener noreferrer">https://effortlessautomation.wordpress.com/</a></h4>

    </div>
  </div>

  <script>
    const tabs = document.querySelectorAll('.tab');
    const contents = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        contents.forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    const widthInput = document.getElementById('widthInput');
    const heightInput = document.getElementById('heightInput');
    const lockAspect = document.getElementById('lockAspect');
    let originalAspect = 1;

    widthInput.addEventListener('input', () => {
      if (lockAspect.checked && widthInput.value) {
        heightInput.value = Math.round(widthInput.value / originalAspect);
      }
    });

    heightInput.addEventListener('input', () => {
      if (lockAspect.checked && heightInput.value) {
        widthInput.value = Math.round(heightInput.value * originalAspect);
      }
    });

    function sanitizeFileName(name) {
      return name.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9._-]/g, '');
    }

    function loadImage(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function resizeAndDownload() {
      const files = document.getElementById('images').files;
      const percent = parseInt(document.getElementById('percentInput').value);
      const mode = document.querySelector('.tab.active').dataset.tab;
      const status = document.getElementById('status');

      if (!files.length) {
        alert("Please select images first.");
        return;
      }

      status.textContent = "Processing...";

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const img = await loadImage(file);

        if (i === 0) originalAspect = img.width / img.height;

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        let newW = img.width;
        let newH = img.height;

        if (mode === 'percentTab' && percent > 0) {
          newW = Math.round(img.width * percent / 100);
          newH = Math.round(img.height * percent / 100);
        } else if (mode === 'sizeTab') {
          const wVal = parseInt(widthInput.value);
          const hVal = parseInt(heightInput.value);
          if (wVal) {
            newW = wVal;
            newH = lockAspect.checked ? Math.round(wVal / originalAspect) : (hVal || img.height);
          } else if (hVal) {
            newH = hVal;
            newW = lockAspect.checked ? Math.round(hVal * originalAspect) : img.width;
          }
        }

        canvas.width = newW;
        canvas.height = newH;
        ctx.drawImage(img, 0, 0, newW, newH);

        const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.9));

        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'resized_' + sanitizeFileName(file.name);
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);
      }

      status.textContent = "All images downloaded!";
    }
  </script>
</body>
</html>
