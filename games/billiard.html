<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8 Ball Billiards Classic Replica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PBJYBJBFBC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PBJYBJBFBC');
</script>
    <style>
:root {
  /* Vibrant Indigo and Coral Theme */
  --color-white: #FFFFFF;
  --color-black: #000000;
  --color-indigo-500: #4B0082;
  --color-indigo-600: #3F0071;
  --color-indigo-700: #311B92;
  --color-coral-500: #FF6F61;
  --color-coral-600: #F05447;
  --color-gray-100: #F5F5F5;
  --color-gray-200: #E0E0E0;
  --color-gray-300: #BDBDBD;
  --color-gray-700: #424242;
  --color-green-500: #4CAF50;
  --color-red-500: #EF5350;

  /* RGB for Opacity */
  --color-indigo-500-rgb: 75, 0, 130;
  --color-coral-500-rgb: 255, 111, 97;
  --color-gray-700-rgb: 66, 66, 66;

  /* Backgrounds */
  --color-bg-1: rgba(75, 0, 130, 0.1);
  --color-bg-2: rgba(255, 111, 97, 0.1);
  --color-bg-3: rgba(33, 150, 243, 0.1);
  --color-bg-4: rgba(76, 175, 80, 0.1);

  /* Semantic Colors */
  --color-background: var(--color-gray-100);
  --color-surface: var(--color-white);
  --color-text: var(--color-gray-700);
  --color-text-secondary: var(--color-gray-300);
  --color-primary: var(--color-indigo-500);
  --color-primary-hover: var(--color-indigo-600);
  --color-secondary: var(--color-coral-500);
  --color-secondary-hover: var(--color-coral-600);
  --color-border: rgba(var(--color-gray-700-rgb), 0.2);
  --color-btn-primary-text: var(--color-white);
  --color-card-border: rgba(var(--color-gray-700-rgb), 0.1);
  --color-success: var(--color-green-500);
  --color-error: var(--color-red-500);

  /* Typography */
  --font-family-base: 'Inter', sans-serif;
  --font-family-heading: 'Poppins', sans-serif;
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-base: 1rem;
  --font-size-md: 1.125rem;
  --font-size-lg: 1.5rem;
  --font-size-xl: 2rem;
  --font-size-2xl: 2.5rem;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-bold: 700;

  /* Spacing */
  --space-4: 0.25rem;
  --space-8: 0.5rem;
  --space-12: 0.75rem;
  --space-16: 1rem;
  --space-24: 1.5rem;
  --space-32: 2rem;
  --space-48: 3rem;

  /* Radius and Shadows */
  --radius-sm: 0.25rem;
  --radius-base: 0.5rem;
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
  --duration-fast: 200ms;
  --ease-standard: ease-in-out;
}


        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #2c3e50;
            font-family: Arial, sans-serif;
            color: #ecf0f1;
        }
        canvas {
            border: 5px solid #34495e;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }
        #ui h2 {
            margin: 0 0 15px;
            font-size: 26px;
            text-align: center;
        }
        #ui select, #ui button {
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            border: none;
            background: #3498db;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        #ui select:hover, #ui button:hover {
            background: #2980b9;
        }
        #stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        #stats p {
            margin: 5px 0;
        }
        #powerBar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 25px;
            background: #7f8c8d;
            border-radius: 5px;
            overflow: hidden;
            border: 2px solid #34495e;
        }
        #powerFill {
            height: 100%;
            background: #e74c3c;
            width: 0;
            transition: width 0.2s;
        }
        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            max-width: 500px;
            text-align: center;
            display: none;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        #instructions h2 {
            margin: 0 0 15px;
            font-size: 28px;
        }
        #instructions p {
            margin: 10px 0;
            font-size: 16px;
            line-height: 1.5;
        }
        #instructions button {
            padding: 12px 25px;
            background: #3498db;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        #instructions button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <div id="ui">
        <h2>8 Ball Billiards</h2>
        <select id="difficulty">
            <option value="1">Easy</option>
            <option value="2">Medium</option>
            <option value="3">Hard</option>
            <option value="4">Expert</option>
            <option value="5">Master</option>
        </select>
        <button id="toggleAim">Toggle Aim Guide</button>
        <button id="showInstructions">How to Play</button>
        <button id="reset">New Game</button>
    </div>
    <div id="stats">
        <p>Player: <span id="playerTurn">You</span></p>
        <p>Your Balls: <span id="ballType">Not Assigned</span></p>
        <p>Balls Left: <span id="ballsLeft">7</span></p>
        <p>Game Status: <span id="gameStatus">In Progress</span></p>
    </div>
    <div id="powerBar"><div id="powerFill"></div></div>
    <div id="instructions">
        <h2>How to Play 8 Ball Billiards</h2>
        <p><strong>Objective:</strong> Pocket all your balls (solids or stripes) then the 8-ball to win. Your ball type is set by the first ball you pocket.</p>
        <p><strong>Aim:</strong> Move your mouse to aim the cue stick. Click to lock the aim direction. A white line shows the shot path (toggle with "Toggle Aim Guide").</p>
        <p><strong>Power:</strong> Move the mouse left/right to adjust shot power (see power bar). Click again to shoot the cue ball.</p>
        <p><strong>Rules:</strong> Hit your balls first. Pocketing the cue ball or opponent's balls ends your turn. Pocketing the 8-ball early means you lose.</p>
        <p><strong>Computer Opponent:</strong> The computer plays as Player 2. Adjust difficulty (Easy to Master) to change its skill.</p>
        <p><strong>Timer:</strong> You have 30 seconds per turn, or your turn ends.</p>
        <button id="closeInstructions">Start Playing</button>
    </div>
    <script>
        let balls = [];
        let cueBall;
        let cueStick;
        let table;
        let playerTurn = 1; // 1 = User, 2 = Computer
        let playerBalls = [null, null]; // [user, computer] - "solids" or "stripes"
        let gameState = "instructions"; // Start with instructions
        let power = 50; // Default power
        let maxPower = 100;
        let aiming = false;
        let aimLocked = false;
        let aimGuide = true;
        let difficulty = 1;
        let shotTimer = 30;
        let timeLeft = shotTimer;
        let eightBallPotted = false;

        function setup() {
            createCanvas(800, 400);
            table = { x: 50, y: 50, w: 700, h: 300, pockets: [
                { x: 50, y: 50, r: 15 }, { x: 400, y: 50, r: 15 }, { x: 750, y: 50, r: 15 },
                { x: 50, y: 350, r: 15 }, { x: 400, y: 350, r: 15 }, { x: 750, y: 350, r: 15 }
            ]};
            resetBalls();
            cueStick = { x: cueBall.x, y: cueBall.y, angle: 0, power: 0 };
            document.getElementById("difficulty").addEventListener("change", (e) => {
                difficulty = parseInt(e.target.value);
            });
            document.getElementById("toggleAim").addEventListener("click", () => {
                aimGuide = !aimGuide;
            });
            document.getElementById("showInstructions").addEventListener("click", () => {
                gameState = "instructions";
                document.getElementById("instructions").style.display = "block";
            });
            document.getElementById("closeInstructions").addEventListener("click", () => {
                gameState = "aiming";
                document.getElementById("instructions").style.display = "none";
                timeLeft = shotTimer;
            });
            document.getElementById("reset").addEventListener("click", resetGame);
            document.getElementById("instructions").style.display = "block"; // Show instructions at start
        }

        function resetBalls() {
            balls = [];
            cueBall = { x: 200, y: 200, r: 10, vx: 0, vy: 0, type: "cue", potted: false };
            let ballPositions = [
                { x: 600, y: 200 }, { x: 620, y: 190 }, { x: 620, y: 210 }, { x: 640, y: 180 },
                { x: 640, y: 200 }, { x: 640, y: 220 }, { x: 660, y: 170 }, { x: 660, y: 190 },
                { x: 660, y: 210 }, { x: 660, y: 230 }, { x: 680, y: 160 }, { x: 680, y: 180 },
                { x: 680, y: 200 }, { x: 680, y: 220 }, { x: 680, y: 240 }
            ];
            let types = ["solid", "stripe", "solid", "stripe", "solid", "stripe", "solid", "stripe", "solid", "stripe", "solid", "stripe", "solid", "stripe", "eight"];
            for (let i = 0; i < 15; i++) {
                balls.push({ x: ballPositions[i].x, y: ballPositions[i].y, r: 10, vx: 0, vy: 0, type: types[i], potted: false, counted: false });
            }
        }

        function resetGame() {
            resetBalls();
            playerTurn = 1;
            playerBalls = [null, null];
            gameState = "instructions";
            eightBallPotted = false;
            timeLeft = shotTimer;
            aimLocked = false;
            power = 50;
            document.getElementById("instructions").style.display = "block";
            updateUI();
        }

        function draw() {
            background(34, 139, 34); // Green table
            drawTable();
            drawBalls();
            if (gameState !== "instructions") {
                drawCueStick();
            }
            if (gameState === "aiming" && playerTurn === 1) {
                updateCueStick();
                if (aimLocked) {
                    let powerPos = (mouseX - width / 2) / (width / 2);
                    power = constrain(map(powerPos, -1, 1, 0, maxPower), 0, maxPower);
                    document.getElementById("powerFill").style.width = power + "%";
                }
                timeLeft -= 1 / frameRate();
                if (timeLeft <= 0) {
                    switchPlayer();
                }
            } else if (gameState === "moving") {
                updateBalls();
                if (allBallsStopped()) {
                    checkPottedBalls();
                    gameState = "aiming";
                    aimLocked = false;
                    power = 50;
                    timeLeft = shotTimer;
                }
            } else if (gameState === "aiming" && playerTurn === 2) {
                console.log("AI turn triggered");
                aiTurn();
            }
            updateUI();
        }

        function drawTable() {
            fill(139, 69, 19); // Brown border
            rect(table.x - 10, table.y - 10, table.w + 20, table.h + 20);
            fill(34, 139, 34); // Green felt
            rect(table.x, table.y, table.w, table.h);
            fill(0); // Pockets
            for (let pocket of table.pockets) {
                ellipse(pocket.x, pocket.y, pocket.r * 2);
            }
        }

        function drawBalls() {
            for (let ball of balls.concat([cueBall])) {
                if (!ball.potted) {
                    if (ball.type === "cue") fill(255);
                    else if (ball.type === "solid") fill(255, 165, 0);
                    else if (ball.type === "stripe") fill(0, 0, 255);
                    else if (ball.type === "eight") fill(0);
                    ellipse(ball.x, ball.y, ball.r * 2);
                }
            }
        }

        function drawCueStick() {
            if (gameState === "aiming" && (playerTurn === 1 || playerTurn === 2)) {
                push();
                translate(cueBall.x, cueBall.y);
                rotate(cueStick.angle);
                stroke(139, 69, 19);
                strokeWeight(4);
                line(0, 0, 50, 0);
                if (aimGuide) {
                    stroke(255, 255, 255, 100);
                    line(0, 0, 200, 0);
                }
                pop();
            }
        }

        function updateCueStick() {
            if (!aimLocked || playerTurn === 2) {
                let dx = mouseX - cueBall.x;
                let dy = mouseY - cueBall.y;
                if (playerTurn === 2) {
                    // AI will set its own angle
                } else {
                    cueStick.angle = atan2(dy, dx);
                }
            }
            cueStick.x = cueBall.x;
            cueStick.y = cueBall.y;
        }

        function updateBalls() {
            for (let ball of balls.concat([cueBall])) {
                if (!ball.potted) {
                    ball.x += ball.vx;
                    ball.y += ball.vy;
                    ball.vx *= 0.98; // Friction
                    ball.vy *= 0.98;
                    if (ball.x - ball.r < table.x) { ball.x = table.x + ball.r; ball.vx = -ball.vx; }
                    if (ball.x + ball.r > table.x + table.w) { ball.x = table.x + table.w - ball.r; ball.vx = -ball.vx; }
                    if (ball.y - ball.r < table.y) { ball.y = table.y + ball.r; ball.vy = -ball.vy; }
                    if (ball.y + ball.r > table.y + table.h) { ball.y = table.y + table.h - ball.r; ball.vy = -ball.vy; }
                    for (let pocket of table.pockets) {
                        let d = dist(ball.x, ball.y, pocket.x, pocket.y);
                        if (d < pocket.r + ball.r) {
                            ball.potted = true;
                            ball.vx = 0;
                            ball.vy = 0;
                        }
                    }
                }
            }
            for (let i = 0; i < balls.length; i++) {
                for (let j = i + 1; j < balls.length; j++) {
                    if (!balls[i].potted && !balls[j].potted) {
                        collideBalls(balls[i], balls[j]);
                    }
                }
                if (!balls[i].potted && !cueBall.potted) {
                    collideBalls(balls[i], cueBall);
                }
            }
        }

        function collideBalls(b1, b2) {
            let dx = b2.x - b1.x;
            let dy = b2.y - b1.y;
            let d = dist(b1.x, b1.y, b2.x, b2.y);
            if (d < b1.r + b2.r) {
                let angle = atan2(dy, dx);
                let sinA = sin(angle);
                let cosA = cos(angle);
                let v1x = b1.vx * cosA + b1.vy * sinA;
                let v1y = b1.vy * cosA - b1.vx * sinA;
                let v2x = b2.vx * cosA + b2.vy * sinA;
                let v2y = b2.vy * cosA - b2.vx * sinA;
                let temp = v1x;
                v1x = v2x;
                v2x = temp;
                b1.vx = v1x * cosA - v1y * sinA;
                b1.vy = v1y * cosA + v1x * sinA;
                b2.vx = v2x * cosA - v2y * sinA;
                b2.vy = v2y * cosA + v2x * sinA;
                let overlap = (b1.r + b2.r - d) / 2;
                b1.x -= overlap * cosA;
                b1.y -= overlap * sinA;
                b2.x += overlap * cosA;
                b2.y += overlap * sinA;
            }
        }

        function allBallsStopped() {
            for (let ball of balls.concat([cueBall])) {
                if (!ball.potted && (abs(ball.vx) > 0.01 || abs(ball.vy) > 0.01)) {
                    return false;
                }
            }
            return true;
        }

        function checkPottedBalls() {
            let pottedThisTurn = [];
            for (let ball of balls) {
                if (ball.potted && !ball.counted) {
                    pottedThisTurn.push(ball);
                    ball.counted = true;
                }
            }
            if (cueBall.potted) {
                cueBall.potted = false;
                cueBall.x = 200;
                cueBall.y = 200;
                cueBall.vx = 0;
                cueBall.vy = 0;
                switchPlayer();
                return;
            }
            if (pottedThisTurn.length > 0) {
                if (!playerBalls[playerTurn - 1]) {
                    playerBalls[playerTurn - 1] = pottedThisTurn[0].type;
                    playerBalls[playerTurn % 2] = pottedThisTurn[0].type === "solid" ? "stripe" : "solid";
                }
                let validPot = false;
                for (let ball of pottedThisTurn) {
                    if (ball.type === "eight") {
                        eightBallPotted = true;
                        checkWin();
                        return;
                    }
                    if (ball.type === playerBalls[playerTurn - 1]) {
                        validPot = true;
                    }
                }
                if (!validPot) {
                    switchPlayer();
                }
            } else {
                switchPlayer();
            }
        }

        function checkWin() {
            let playerBallsLeft = balls.filter(b => b.type === playerBalls[playerTurn - 1] && !b.potted).length;
            if (eightBallPotted) {
                if (playerBallsLeft === 0) {
                    gameState = "over";
                    document.getElementById("gameStatus").innerText = playerTurn === 1 ? "You Win!" : "Computer Wins!";
                } else {
                    gameState = "over";
                    document.getElementById("gameStatus").innerText = playerTurn === 1 ? "Computer Wins!" : "You Win!";
                }
            }
        }

        function switchPlayer() {
            playerTurn = playerTurn === 1 ? 2 : 1;
            timeLeft = shotTimer;
            aimLocked = false;
            power = 50;
            updateUI();
        }

        function updateUI() {
            document.getElementById("playerTurn").innerText = playerTurn === 1 ? "You" : "Computer";
            document.getElementById("ballType").innerText = playerBalls[playerTurn - 1] ? playerBalls[playerTurn - 1].charAt(0).toUpperCase() + playerBalls[playerTurn - 1].slice(1) : "Not Assigned";
            document.getElementById("ballsLeft").innerText = balls.filter(b => b.type === playerBalls[playerTurn - 1] && !b.potted).length || 7;
            if (gameState !== "over") {
                document.getElementById("gameStatus").innerText = "In Progress";
            }
        }

        function aiTurn() {
            console.log("AI turn: playerBalls[1] =", playerBalls[1]);
            let targetBall = null;
            let minDist = Infinity;
            // If no ball type assigned, AI can target any solid or stripe (open table)
            let validTypes = playerBalls[1] ? [playerBalls[1]] : ["solid", "stripe"];
            for (let ball of balls) {
                if (!ball.potted && validTypes.includes(ball.type)) {
                    let d = dist(cueBall.x, cueBall.y, ball.x, ball.y);
                    if (d < minDist) {
                        minDist = d;
                        targetBall = ball;
                    }
                }
            }
            if (targetBall) {
                console.log("AI targeting ball at", targetBall.x, targetBall.y, "type:", targetBall.type);
                let dx = targetBall.x - cueBall.x;
                let dy = targetBall.y - cueBall.y;
                cueStick.angle = atan2(dy, dx);
                power = random(20, 80) * difficulty / 5;
                // Immediate shot for testing
                cueBall.vx = cos(cueStick.angle) * power * 0.15;
                cueBall.vy = sin(cueStick.angle) * power * 0.15;
                gameState = "moving";
                power = 50;
                document.getElementById("powerFill").style.width = "50%";
            } else {
                console.log("AI found no target ball, passing turn");
                switchPlayer(); // Pass turn if no valid target
            }
        }

        function mousePressed() {
            if (gameState === "aiming" && playerTurn === 1) {
                if (!aimLocked) {
                    aimLocked = true; // Lock aim direction on first click
                } else {
                    // Shoot on second click
                    cueBall.vx = cos(cueStick.angle) * power * 0.15;
                    cueBall.vy = sin(cueStick.angle) * power * 0.15;
                    gameState = "moving";
                    aimLocked = false;
                    power = 50;
                    document.getElementById("powerFill").style.width = "50%";
                }
            }
        }
    </script>
</body>

</html>
